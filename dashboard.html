<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>GEMS Command | 2026 Launch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .glass { background: rgba(255,255,255,0.02); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.05); }
        .custom-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-72 border-r border-white/5 p-6 flex flex-col glass">
        <div class="font-black text-2xl mb-10 tracking-tighter italic">LAUNCH<span class="text-blue-500">AI_4</span></div>
        <nav class="space-y-2 flex-1">
            <button onclick="setAgent('SecretaryAI')" class="w-full text-left p-3 rounded-xl hover:bg-blue-600/20 text-xs font-bold transition-all"><i class="fa-solid fa-shield-halved mr-2 text-blue-500"></i> SecretaryAI</button>
            <button onclick="setAgent('MentorAI')" class="w-full text-left p-3 rounded-xl hover:bg-blue-600/20 text-xs font-bold transition-all"><i class="fa-solid fa-user-tie mr-2 text-blue-500"></i> MentorAI</button>
            <div class="h-px bg-white/10 my-4"></div>
            <button onclick="lockCheck('LawyerAI')" class="w-full text-left p-3 text-xs opacity-40 hover:opacity-100"><i class="fa-solid fa-lock mr-2 text-red-500"></i> LawyerAI</button>
            <button onclick="lockCheck('AccountantAI')" class="w-full text-left p-3 text-xs opacity-40 hover:opacity-100"><i class="fa-solid fa-lock mr-2 text-green-500"></i> AccountantAI</button>
        </nav>
        
        <div class="mt-auto p-4 bg-blue-600/10 border border-blue-500/20 rounded-2xl">
            <img src="Tier1.png" class="w-full rounded-lg mb-3 shadow-2xl grayscale hover:grayscale-0 transition-all">
            <div class="text-[10px] font-black text-center text-blue-400 tracking-widest uppercase">Founder Tier Active</div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="p-6 border-b border-white/5 flex justify-between items-center glass">
            <div>
                <span id="activeAgent" class="text-xs font-black uppercase text-blue-500">SecretaryAI</span>
                <div class="text-[9px] text-slate-500 mt-1 uppercase tracking-tighter">Neural Stream: Stable</div>
            </div>
            <div class="bg-green-500/10 text-green-500 text-[10px] px-3 py-1 rounded-full font-bold">‚óè 24/7 ACTIVE</div>
        </header>

        <div id="chat" class="flex-1 p-8 overflow-y-auto space-y-6 custom-scroll"></div>

        <div class="p-6 bg-slate-950/80 border-t border-white/5">
            <div class="max-w-4xl mx-auto flex gap-4">
                <input id="msg" onkeypress="if(event.key==='Enter') send()" type="text" placeholder="Command the roadmap..." 
                       class="flex-1 bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-blue-500/50 transition-all text-sm">
                <button onclick="send()" class="bg-blue-600 px-6 rounded-2xl hover:scale-105 transition-transform">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        let agent = "SecretaryAI";
        const chat = document.getElementById('chat');

        window.onload = () => {
            const idea = localStorage.getItem('userIdea') || "Stealth Venture";
            appendMsg("SecretaryAI", `Welcome, Founder. I've initiated the board. MentorAI is already generating your **30-Day Launch Roadmap** for "${idea}". Stand by for uplink...`);
            
            // Auto-trigger Mentor
            setTimeout(() => {
                setAgent('MentorAI');
                send("Mentor, I need the 30-day launch roadmap. Break it down by weeks. Give me the hard truths.");
            }, 2000);
        };

        function setAgent(a) {
            agent = a;
            document.getElementById('activeAgent').innerText = a;
            appendMsg("System", `Switching to ${a} frequency...`);
        }

        function lockCheck(a) {
            alert(`Architect Tier Required to unlock ${a}. Update your subscription to gain full board access.`);
        }

        async function send(overrideMsg = null) {
            const m = overrideMsg || document.getElementById('msg').value;
            if(!m) return;
            if(!overrideMsg) {
                appendMsg("You", m);
                document.getElementById('msg').value = "";
            }

            let aiId = appendMsg(agent, "...");
            const res = await fetch('/api/architect', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    messages: [{role: 'user', content: m}], 
                    agent: agent, 
                    idea: localStorage.getItem('userIdea'),
                    tier: "Founder" 
                })
            });

            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let text = "";
            
            while (true) {
                const {done, value} = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value).split('\n');
                chunk.forEach(line => {
                    if (line.startsWith('data: ')) {
                        try {
                            const data = JSON.parse(line.substring(6));
                            const content = data.choices[0].delta.content || "";
                            text += content;
                            document.getElementById(aiId).innerText = text;
                        } catch(e) {}
                    }
                });
            }
        }

        function appendMsg(s, t) {
            const id = "m-" + Date.now();
            const isUser = s === 'You';
            chat.innerHTML += `
                <div class="flex ${isUser ? 'justify-end' : 'justify-start'}">
                    <div class="max-w-2xl p-5 rounded-3xl ${isUser ? 'bg-blue-600' : 'glass'}">
                        <div class="text-[9px] uppercase font-black mb-2 ${isUser ? 'text-blue-100' : 'text-blue-500'}">${s}</div>
                        <div id="${id}" class="text-sm leading-relaxed">${t}</div>
                    </div>
                </div>`;
            chat.scrollTop = chat.scrollHeight;
            return id;
        }
    </script>
</body>
</html>
